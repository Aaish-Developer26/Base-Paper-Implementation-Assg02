# Configuration for Compression-Aligned CLIP-kNN

model:
  name: "ViT-B-32"
  pretrained: "laion2b_s34b_b79k"
  image_size: 224

paths:
  test_root: "data/test_stress"  # Add this new parameter
  data_root: "data"
  cache_root: "cache"
  figs_root: "reports/figures"

# NEW: Experiment settings
experiment:
  # Set to true to build and compare both vanilla and CACNN
  run_comparison: true  # Change to false for normal single-method mode

build_bank:
  # Maximum images per class (for speed)
  max_per_class: 50
  
  # Augmentation parameters (used when use_augmentation=True)
  augment:
    # For vanilla baseline comparison, start with moderate augmentation
    jpeg_qualities: [95, 85, 70]    # JPEG compression levels
    resize_scales: [1.0, 0.75]      # Image resize scales
    blur_sigmas: [0.0]              # Gaussian blur (0.0 = no blur)
    
    # For full robustness testing, you can add:
    # jpeg_qualities: [95, 85, 70, 50]
    # resize_scales: [1.0, 0.75, 0.5]
    # blur_sigmas: [0.0, 1.0]

detect:
  k: 5                              # Number of nearest neighbors
  alpha: 0.5                        # Weight: centroid (alpha) vs kNN (1-alpha)
  use_mahalanobis: false            # Use Mahalanobis distance (slower but better)
  
  tta:
    enable: false                   # Test-time augmentation
    jpeg_qualities: [95, 85]
    resize_scales: [1.0]

eval:
  max_per_class: 20                 # Max test images per class (for speed)
  
  metrics:
    - "auroc"
    - "accuracy"
    - "f1"
  
  plot_roc: true
  
  # Stress test parameters (compression/resize/blur)
  stress:
    jpeg_qualities: [85, 70]        # Moderate to heavy compression
    resize_scales: [0.75]           # 75% of original size
    blur_sigmas: [0.0]              # No blur for now
    
    # For more aggressive stress testing:
    # jpeg_qualities: [85, 70, 50]
    # resize_scales: [0.75, 0.5]
    # blur_sigmas: [1.0, 2.0]